{#<script>#}
var leadsfactory = {
    html: '{{ include(template_from_string(form.source))|e('js') }}',
    init: function (form_id, data, options) {
        var $ = jQuery;
        var form = $('#' + form_id);

        $.each(data, function (key, value) {
            var field = $('[id=lffield\\[' + key + '\\]]', form);

            // Mise Ã  jour par appel d'evenement des champs
            if (typeof field.data('list') !== "undefined" && typeof field.data('parent') !== "undefined") {
                var id = '#lffield\\[' + field.data('parent') + '\\]';

                $(id).change(function () {
                    setTimeout(function () {
                        field.val(value);
                        console.log(field.val());
                        if (field.val() == null) {
                            $(id).change();
                        }
                        field.val(value);
                    }, 1000);
                });

                $(id).change();
            }

            if (field.attr('type') == 'checkbox' || field.attr('type') == 'radio') {
                field.prop('checked', value);
            } else {
                field.val(value);
            }

        });


        var imageSrc = "{{ trackingAction }}/{{ formId }}/" + this.codeAction;

        var trackingImage = $('<img/>', {
            id: 'trackingImage',
            src: imageSrc,
            height: 1,
            width: 1
        });
        form.after(trackingImage);
        //form.insertAfter ("<img src='{{ trackingAction }}/"+form_id+"/"+this.codeAction+"'/> height='1' width='1'");
        {{ form.script|raw }}
    },
    codeAction: "{{ utm_campaign }}",
    setCodeAction: function (codeAction) {
        this.codeAction = codeAction;
    }
};
{#</script>#}
